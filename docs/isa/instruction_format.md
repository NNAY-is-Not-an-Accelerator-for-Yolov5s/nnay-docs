# 指令集架构概述

## NNAY 指令集简介

NNAY指令集是一套专门设计用于加速神经网络推理，特别是YOLOv5目标检测模型的指令集架构。该指令集通过优化计算密集型操作（如卷积、池化和激活函数）来提高模型执行效率，减少延迟并降低功耗。

NNAY指令集的每条指令可能由多个指令块(Instruction Block)组成，每个指令块固定为8字节。

## NNAY 指令集格式

NNAY 的每个指令长度不定，但均为8字节的整数倍。

对于每条指令的头8个字节，规定如下：

| 字段   | 长度 | 描述       |
| ------ | ---- | ---------- |
| [1:0]  | 2    | Opcode     |
| [5:2]  | 4    | Sub Opcode |
| [7:6]  | 2    | Funct   |
| [63:8] | 56   | 指令参数   |

## 指令分类

指令分为：

- 配置指令 (Configuration Instruction)
  - 用于配置加速器
  - Opcode: 0b00
- 计算指令 (Compute Instruction)
  - 用于执行计算操作
  - Opcode: 0b01
- 控制指令 (Control Instruction)
  - 用于控制加速器
  - Opcode: 0b10

## 地址计算

NNAY 指令中出现的地址偏移需要通过以下公式计算：

```
Addr = BaseAddr[4:0] << 27 | Offset[23:0] << 3 | 0b000
```

其中，`BaseAddr` 为基地址，`Offset` 为偏移量。

最小寻址单位为字节，均以小端存储。